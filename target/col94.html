<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>El Moose està volant (1a part) (juny 07)</title><!--
  template modtime is 08:05:54 11-May-2007
-->
  <meta name="description" content="">
  <meta name="keywords" content="Perl!">


<BASE HREF="http://www.stonehenge.com/">
<LINK REL="StyleSheet" HREF="/style.css" TYPE="text/css" MEDIA="screen">
</head>
<body bgcolor="white">

<div id="header">
	<a href="index.html"><img src="/stonehenge-logo.png" border="0" 
		widht="340" height="75"></a><a href="http://www.theperlreview.com"><img
        style="margin-left: 50px"
        src="/images/tpr-banner.png"
        alt="The Perl Review: la revista de Perl"
        height="53"
        width="350"
        border="0"></a>         <br/>
	<h2 id="tagline">Formació i consultoria arreu del món per experts en Perl</h2>
</div>  

<div id="nav">
<a class="jumptocontent" href="#content">Salteu al contingut...</a>
<ul class="navbars">
<li class="navbar"><p class="navbarlabel"></p>
<ul class="navbarbuttons"><li class="navbaractivebutton"><a href="/merlyn/columns.html"><b>Columnes</b></a>
</li><li class="navbarbutton"><a href="/merlyn/pictures.html">Fotografies</a>
</li><li class="navbarbutton"><a href="/merlyn/">Randal</a>
</li></ul>
</li><li class="navbar"><p class="navbarlabel">Columnes d'en Randal</p>
<ul class="navbarbuttons"><li class="navbaractivebutton"><a href="/merlyn/LinuxMag/"><b>Columnes a LM</b></a>
</li><li class="navbarbutton"><a href="/merlyn/PerlJournal/">Columnes a PJ</a>
</li><li class="navbarbutton"><a href="/merlyn/UnixReview/">Columnes a UR</a>
</li><li class="navbarbutton"><a href="/merlyn/WebTechniques/">Columnes a WT</a>
</li></ul>
</li><li class="navbar"><p class="navbarlabel">Columnes d'en Randal a LM</p>
<ul class="navbarbuttons"><li class="navbarbutton"><a href="/merlyn/LinuxMag/col01.html">01</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col02.html">02</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col03.html">03</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col04.html">04</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col05.html">05</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col06.html">06</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col07.html">07</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col08.html">08</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col09.html">09</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col10.html">10</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col11.html">11</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col12.html">12</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col13.html">13</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col14.html">14</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col15.html">15</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col16.html">16</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col17.html">17</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col18.html">18</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col19.html">19</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col20.html">20</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col21.html">21</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col22.html">22</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col23.html">23</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col24.html">24</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col25.html">25</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col26.html">26</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col27.html">27</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col28.html">28</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col29.html">29</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col30.html">30</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col31.html">31</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col32.html">32</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col33.html">33</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col34.html">34</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col35.html">35</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col36.html">36</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col37.html">37</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col38.html">38</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col39.html">39</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col40.html">40</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col41.html">41</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col42.html">42</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col43.html">43</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col44.html">44</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col45.html">45</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col46.html">46</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col47.html">47</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col48.html">48</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col49.html">49</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col50.html">50</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col51.html">51</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col52.html">52</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col53.html">53</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col54.html">54</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col55.html">55</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col56.html">56</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col57.html">57</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col58.html">58</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col59.html">59</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col60.html">60</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col61.html">61</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col62.html">62</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col63.html">63</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col64.html">64</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col65.html">65</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col66.html">66</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col67.html">67</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col68.html">68</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col69.html">69</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col70.html">70</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col71.html">71</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col72.html">72</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col73.html">73</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col74.html">74</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col75.html">75</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col76.html">76</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col77.html">77</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col78.html">78</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col79.html">79</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col80.html">80</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col81.html">81</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col82.html">82</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col83.html">83</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col84.html">84</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col85.html">85</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col86.html">86</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col87.html">87</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col88.html">88</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col89.html">89</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col90.html">90</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col91.html">91</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col92.html">92</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col93.html">93</a>
</li><li class="navbaractivebutton"><a href="/merlyn/LinuxMag/col94.html"><b>94</b></a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col95.html">95</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col96.html">96</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col97.html">97</a>
</li><li class="navbarbutton"><a href="/merlyn/LinuxMag/col98.html">98</a>
</li></ul>
</li></ul>
<a class="jumptocontent" name="content"></a>
<hr><!-- Search Google -->
<div align="center">
<FORM method="GET" action="http://www.google.com/custom">
<A class="google" HREF="http://www.google.com/search">
<IMG cclass="google" SRC=http://www.google.com/logos/Logo_40wht.gif border=0 ALT=Google align=middle></A><br />
<INPUT TYPE=text name=q size=15 maxlength=255 value=""><br />
<INPUT type=submit name=sa VALUE="Cerqueu a Stonehenge">
<INPUT type=hidden name=cof VALUE="S:http://www.stonehenge.com;AH:center;AWFID:c32c3e920bca5918;">
<input type=hidden name=domains value="stonehenge.com"><input type=hidden name=sitesearch value="stonehenge.com">
</FORM>
</div><!-- Search Google -->
<hr><small>Darrera modificació a les 08:05:54 11-May-2007.</small>
</div>

<div id="content">

<script type="text/javascript"><!--
google_ad_client = "pub-5232500565828778";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text";
google_ad_channel ="2524837445";
google_color_border = "FF4500";
google_color_bg = "FFEBCD";
google_color_link = "DE7008";
google_color_url = "E0AD12";
google_color_text = "8B4513";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br>
<h2>Avís de copyright</h2>El copyright d'aquest text és propietat d'InfoStrada Communications, Inc. i s'utilitza amb el seu permís. Qualsevol altre tipus de difusió o ús no està permès.<p>Aquest text va aparèixer en una edició de la revista <cite>Linux Magazine</cite>. Tanmateix, la versió que esteu llegint aquí és l'article original tal com l'autor el va enviar per a ser publicat, abans que els editors apliquessin la seva creativitat.</p><p>Si us plau, llegiu tota la informació de <a href="./">l'índex</a> abans d'utilitzar aquest article.<tr bgcolor="#ffffff"><td bgcolor="#ffffff">
<p>
</p>
<h1><a name="linux_magazine_column_94__jun_2007_">Columna 94 del Linux Magazine (juny de 2007)</a></h1>
<p>[títol suggerit: «El Moose està volant (1a part)»]</p>
<p>El sistema d'objectes de Perl és molt «flexible», és a dir, es construeix de baix cap a dalt. Podeu construir objectes tradicionals basats en taules de dispersió, o objectes més exòtics basats en matrius o objectes capgirats. Aleshores heu de crear els mètodes accessors, definir les polítiques d'accés i generar un munt de codi repetit.</p>
<p>Afortunadament, Perl és prou introspectiu com perquè li encomaneu la majoria del treball dur i avorrit. Això ha provocat que un bon nombre «d'entorns de treball per a classes» hagin estat publicats al CPAN. L'enton de treball <code>Moose</code> va sorgir fa un any i inicialment jo el vaig descartar com «un altre entorn de treball per a classes», de la mateixa manera que un altre sistema de plantilles o un altre mapeig d'objectes relacional em fan sentir.</p>
<p>Tanmateix, vaig fer un cop d'ull recentment al que s'havia convertit <code>Moose</code> i em vaig endur una sorpresa agradable. Així que em vaig posar a jugar-hi, sovint vaig exclamar que aquest entorn de treball m'hauria estalviat un bona pila de temps en alguns projectes passats, com ara el text que vaig escriure per al nostre curs i llibre <em>Intermediate Perl</em>, algunes parts del qual s'han inclòs com la pàgina de manual <em>perlboot</em> a la distribució. Posem-nos a refer les classes «d'animals» d'aquell text utilitzant <code>Moose</code> per veure com aquest entorn de treball emergent simplifica les coses.</p>
<p>Primer crearem la classe cavall a <code>Horse.pm</code> que té un nom i un color:</p>
<pre>
  package Horse;
  use Moose;
  has 'name' =&gt; (is =&gt; 'rw');
  has 'color' =&gt; (is =&gt; 'rw');
  1;</pre>
<p>Incorporant <code>Moose</code> es defineix <code>has</code>, al qual se li passa el nom d'un atribut juntament amb les seves propietats. En aquest cas, diem que els dos atributs són de «lectura/escriptura». Ara podem utilitzar aquesta classe:</p>
<pre>
  use Horse;
  my $talking = Horse-&gt;new(name =&gt; "Mr. Ed");
  print $talking-&gt;name; # prints Mr. Ed
  $talking-&gt;color("grey"); # sets the color</pre>
<p>Fixeu-vos que no m'ha calgut definir un mètode <code>new</code>: Moose ho fa per mi.</p>
<p>En el text original <code>Horse</code> heretava d'<code>Animal</code>. Podem fer això molt fàcilment. Posem a <code>Animal.pm</code>:</p>
<pre>
  package Animal;
  use Moose;
  has 'name' =&gt; (is =&gt; 'rw');
  has 'color' =&gt; (is =&gt; 'rw');
  1;</pre>
<p>I aleshores actualitzem el nostre <code>Horse.pm</code>:</p>
<pre>
  package Horse;
  use Moose;
  extends 'Animal';
  1;</pre>
<p>Fixeu-vos que aquí <code>extends</code> substitueix el tradicional <code>use base</code> i fixa completament <code>@ISA</code>, enlloc d'afegir-hi un element. (És possible que vulgueu posar això dins d'un bloc BEGIN, tot i que encara no he vist cap exemple que ho necessiti).</p>
<p>En aquest punt, <code>Horse</code> i <code>Animal</code> són idèntics. Els dos es poden instanciar i se'ls pot assignar atributs. En l'exemple original, el que distingia un cavall era el so que feia, cosa que podem afegir aquí:</p>
<pre>
  package Horse;
  use Moose;
  extends 'Animal';
  sub sound { 'neigh' }
  1;</pre>
<p>i aleshores fer-hi referència al mètode comú <code>speak</code> d'<code>Animal</code>:</p>
<pre>
  package Animal;
  use Moose;
  has 'name' =&gt; (is =&gt; 'rw');
  has 'color' =&gt; (is =&gt; 'rw');
  sub speak {
    my $self = shift;
    print $self-&gt;name, " goes ", $self-&gt;sound, "\n";
  }
  sub sound { confess shift, " should have defined sound!" }
  1;</pre>
<p>Fixeu-vos en l'ús de <code>confess</code>, un altre regal de Moose. Si la classe derivada no ha definit un so, vull queixar-me. Però com que <code>Horse</code> defineix <code>sound</code>, no veure mai això per un cavall. Amb aquest codi puc crear el meu clàssic cavall parlador:</p>
<pre>
  my $talking = Horse-&gt;new(name =&gt; 'Mr. Ed');
  $talking-&gt;speak; # says "Mr. Ed goes neigh"</pre>
<p>Fins ara només estic programant coses que serien senzilles sense Moose, així que comencem a fer alguns canvis per veure'n tot el poder. Primer, un <code>Animal</code> és en realitat una classe abstracta, utilitzada només per proveïr atributs i mètodes comuns per a una classe concreta (en aquest cas, la classe cavall). En la terminologia de Moose això es descriu millor com un <em>rol</em>. Un rol és com un <em>mix-in</em>, que proveeix una col·lecció d'atributs i mètodes que utilitzen aquells atributs. Un rol mai té cap instància perquè no és una classe completa.</p>
<p>Quan fem que <code>Animal</code> sigui un rol també obtenim suport addicional:</p>
<pre>
  package Animal;
  use Moose::Role;
  has 'name' =&gt; (is =&gt; 'rw');
  has 'color' =&gt; (is =&gt; 'rw');
  sub speak {
    my $self = shift;
    print $self-&gt;name, " goes ", $self-&gt;sound, "\n";
  }
  requires 'sound';
  1;</pre>
<p>Fixeu-vos que hem substituït l'«stub» que incloïa el confess per un <code>requires</code>. Això informa a Moose que les classes que usin aquest rol han de proveir el mètode <code>sound</code>, que serà verificat en temps de compilació. Per atorgar un rol utilitzem <code>with</code> enlloc d'<code>extends</code>:</p>
<pre>
  package Horse;
  use Moose;
  with 'Animal';
  sub sound { 'neigh' }
  1;</pre>
<p>Si ens haguéssim oblidat d'incloure <code>sound</code> hauríem rebut un avís de bon començament. Genial. En aquest punt, <code>Horse</code> segueix funcionant com abans.</p>
<p>Què passa amb les paraules clau <code>with</code> i <code>requires</code>? Com que estan definits per les importacions de <code>Moose</code> i <code>Moose::Role</code>, romandran com a part del paquet. Per als puristes com nosaltres als que no ens agrada aquest tipus de pol·lució, podem eliminar-los quan hàgim acabat utilitzant la paraula clau <code>no</code> (de forma similar a <code>use strict</code> i <code>no strict</code>). Per exemple, podem netejar <code>Horse.pm</code> amb:</p>
<pre>
  package Horse;
  use Moose;
  with 'Animal';
  sub sound { 'neigh' }
  no Moose; # gets rid of scaffolding
  1;</pre>
<p>I de forma similar, <code>Animal.pm</code> necessita <code>no Moose::Role</code> al final.</p>
<p>Moose ofereix suport per a la noció de valor predeterminat. Afegim el color predeterminat i fem que això també sigui responsabilitat de la classe:</p>
<pre>
  package Animal;
  ...
  has 'color' =&gt; (is =&gt; 'rw', default =&gt; sub { shift-&gt;default_color });
  requires 'default_color';
  ...</pre>
<p>Si no s'indica el color, es consultarà el color predeterminat de la classe i <code>requires</code> garanteix que la classe concreta proveeix aquest color predeterminat. Les nostres classes derivades ara tenen aquest aspecte:</p>
<pre>
  ## Cow.pm:
  package Cow;
  use Moose;
  with 'Animal';
  sub default_color { 'spotted' }
  sub sound { 'moooooo' }
  no Moose;
  1;
  ## Horse.pm:
  package Horse;
  use Moose;
  with 'Animal';
  sub default_color { 'brown' }
  sub sound { 'neigh' }
  no Moose;
  1;
  ## Sheep.pm:
  package Sheep;
  use Moose;
  with 'Animal';
  sub default_color { 'black' }
  sub sound { 'baaaah' }
  no Moose;
  1;</pre>
<p>Ara «ovella» és una més de les nostres classes implementades:</p>
<pre>
  use Sheep;
  my $baab = Sheep-&gt;new(color =&gt; 'white', name =&gt; 'Baab');
  $baab-&gt;speak; # prints "Baab goes baaaah"</pre>
<p>Bé, això és força pim pam. Anem a resoldre alguns dels altres problemes del material original.</p>
<p>La classe <code>Mouse</code> era especial perquè extenia el mètode <code>speak</code> amb una línia addicional de sortida. Tot i que podríem utilitzar els mètodes tradicionals basats en <code>SUPER::</code> per cridar els comportaments de la classe pare, això no funciona amb els rols. (Els rols no acaben dins de <code>@ISA</code> perquè estan «empegats per dins» enlloc d'«enganxats al damunt»).</p>
<p>Afortunadament, Moose ofereix convenientment la crida <code>after</code> per afegir passes addicionals al final d'una subrutina existent. Moose fa això substituint la subrutina original per una nova subrutina que crida l'orginal i tot seguit crida al codi addicional. El context (llista, escalar, o buit) es conserva de forma adequada, així com també el valor de retorn original. El nostre <code>speak</code> retocat té aquesta pinta:</p>
<pre>
  package Mouse;
  use Moose;
  with 'Animal';
  sub default_color { 'white' }
  sub sound { 'squeak' }
  after 'speak' =&gt; sub {
    print "[but you can barely hear it!]\n";
  };
  no Moose;
  1;</pre>
<p>Això ens dóna un ratolí que funciona correctament:</p>
<pre>
  my $mickey = Mouse-&gt;new(name =&gt; 'Mickey');
  $mickey-&gt;speak;</pre>
<p>que dóna com a resultat:</p>
<pre>
  Mickey goes squeak
  [but you can barely hear it!]</pre>
<p>També podem utilitzar <code>before</code> per a precedir el comportament original o <code>around</code> per a controlar com es crida el comportament original, segons calgui. Per exemple, per a permetre que <code>name</code> s'utilitzi com un mètode accessor però que segueixi retornant <code>an unnamed Horse</code> quan s'utilitzi com un mètode de classe, podem posar un «around» del mètode accessor resultant:</p>
<pre>
  package Animal;
  ...
  has 'name' =&gt; (is =&gt; 'rw');
  around 'name' =&gt; sub {
    my $next = shift;
    my $self = shift;
    blessed $self ? $self-&gt;$next(@_) : "an unnamed $self";
  };</pre>
<p>El <code>has</code> crear el comportament original. L'<code>around</code> intercepta el nom de la subroutina original, fent que la referència al codi original es passi com a primer paràmetre d'aquesta nova subrutina, que nosaltres capturem a <code>$next</code>. Desencuem el <code>$self</code> original i el verifiquem per veure si és un objecte o no, via <code>blessed</code> (exportat per Moose convenientment). Per a un objecte obtenim el comportament original (un «getter» o «setter»), però per a una classe obtindrem la cadena literal.</p>
<p>Què passa si no li posem un nom al nostre animal? Obtindrem avisos sobre valors indefinits. Podem assignar un nom predeterminat tal com vam fer amb el color predeterminat:</p>
<pre>
  has 'name' =&gt; (
    is =&gt; 'rw',
    default =&gt; sub { 'an unnamed ' . ref shift },
   );</pre>
<p>Novament, voldríem aquell <code>around</code> immediatament després d'aquest pas.</p>
<p>Si no volem que la gent canviï el color després de la creació inicial de la instància, declarem l'atribut no modificable:</p>
<pre>
  has 'color' =&gt; (is =&gt; 'ro', default =&gt; sub { shift-&gt;default_color });</pre>
<p>Ara un intent de canviar el color s'avortarà amb <code>Cannot assign a value to a read-only accessor...</code>. Si realment volíem una manera de canviar el color ocasionalment, podem definir a banda un anomenat <em>escriptor</em>:</p>
<pre>
  has 'color' =&gt; (
    is =&gt; 'ro',
    writer =&gt; 'private_set_color',
    default =&gt; sub { shift-&gt;default_color },
  );</pre>
<p>D'aquesta manera no podem canviar el color d'un ratolí directament:</p>
<pre>
  my $m = Mouse-&gt;new;
  my $color = $m-&gt;color; # gets the color
  $m-&gt;color('green'); # DIES</pre>
<p>Però en canvi podem utilitzar un mètode privat:</p>
<pre>
  $m-&gt;private_set_color('green'); # sets the color to green</pre>
<p>Tot utilitzant un nom llarg és menys probable que el cridem accidentalment, a menys que tinguem la intenció de canviar el color.</p>
<p>Anem a crear un <code>RaceHorse</code> afegint «característiques de carrera» a un <code>Horse</code>.</p>
<p>Primer definim «característiques de carrera» com, sí, un altre rol:</p>
<pre>
  package Racer;
  use Moose::Role;
  has $_ =&gt; (is =&gt; 'rw', default =&gt; 0)
    foreach qw(wins places shows losses);
  no Moose::Role;
  1;</pre>
<p>Com que <code>has</code> és només una crida a una subrutina, fixeu-vos que podem utilitzar estructures de control tradicionals de Perl (aquí, un bucle <code>foreach</code>). Amb una mica de codi hem afegit uns altres quatre atributs. El valor inicial <code>0</code> significa que no ens caldrà escriure per separat codi d'inicialització al nostre constructor. Tot seguit podem afegir alguns mètodes accessors:</p>
<pre>
  package Racer;
  ...
  sub won { my $self = shift; $self-&gt;wins($self-&gt;wins + 1) }
  sub placed { my $self = shift; $self-&gt;places($self-&gt;places + 1) }
  sub showed { my $self = shift; $self-&gt;shows($self-&gt;shows + 1) }
  sub lost { my $self = shift; $self-&gt;losses($self-&gt;losses + 1) }</pre>
<pre>
  sub standings {
    my $self = shift;
    join ", ", map { $self-&gt;$_ . " $_" } qw(wins places shows losses);
  }
  ...</pre>
<p>Cada crida a <code>won</code> incrementa el número de victòries. Això seria més senzill si assumíssim que aquests objectes s'implementen amb taules de dispersió (per defecte és així), com ara:</p>
<pre>
  sub won { shift-&gt;{wins}++; }</pre>
<p>Tanmateix, utilitzant la interfície pública (una crida al mètode) podríem canviar més endavant la implementació amb objectes capgirats o objectes basats en matrius sense trencar aquest codi. Això és especialment important quan es crea un rol genèric, que es podria mesclar amb qualsevol tipus d'objecte.</p>
<p>Per a crear la carrera de cavalls només cal que mesclem un cavall amb un corredor:</p>
<pre>
  package RaceHorse;
  use Moose;
  extends 'Horse';
  with 'Racer';
  no Moose;
  1;</pre>
<p>I ara ja podem cavalcar els ponis:</p>
<pre>
  use RaceHorse;
  my $s = RaceHorse-&gt;new(name =&gt; 'Seattle Slew');
  $s-&gt;won; $s-&gt;won; $s-&gt;won; $s-&gt;placed; $s-&gt;lost; # run some races
  print $s-&gt;standings, "\n"; # 3 wins, 1 places, 0 shows, 1 losses</pre>
<p>Fins ara només he rascat la superfície del que proporciona <code>Moose</code>. El proper mes miraré algunes de les característiques més avançades de <code>Moose</code> que ajuden a mantenir les coses complexes de manera relativament simple. Fins aleshores, gaudiu!</p>

</td></tr></p>

</div></body></html>
</td>
</tr>
<hr>Randal L. Schwartz és un expert de renom sobre el llenguatge de programació Perl (l'essència vital d'Internet), que ha contribuït en una dotzena de llibres supervendes en la matèria i més de 200 articles en revistes. En Schwartz té una empresa de formació i consultoria en Perl (Stonehenge Consulting Services, Inc de Portland, Oregon) i és un conferenciant molt buscat gràcies a la seva destresa damunt l'escenari, que combina coneixements tècnics, pauses dramàtiques i sintonia amb el públic. I és força bon cantant de Karaoke, que guanya concursos sovint.<p>Podeu contactar en Schwartz per a comentaris a <a href="mailto:merlyn@stonehenge.com">merlyn@stonehenge.com</a> o al telèfon +1 503 777-0095, i accepta preguntes sobre Perl i d'altres temes relacionats.</div>
</p></body>
</html>

  
